# 游戏数据查询系统 - 项目总结

## 项目概述

本项目是一个完整的游戏数据查询系统，实现了您要求的所有功能。系统采用Python Flask框架开发，提供Web界面进行数据查询和管理。

## 已完成的功能

### ✅ 1. 服务端根目录获取
- 用户输入服务端根目录路径
- 自动定位到Mir200子目录
- 自动验证目录存在性和有效性

### ✅ 2. 端口检测和配置
- 默认端口：8858
- 自动检测端口是否被占用
- 如果被占用，提示用户输入新端口
- 支持动态端口配置

### ✅ 3. 文件检查和数据读取
- **Mir200/Envir/MonItems目录检查**：验证怪物爆出物品目录是否存在
- **Mir200/Envir/MonGen.txt文件检查**：验证怪物刷新配置文件是否存在
- **Mir200/sqlite3.dll检查**：验证SQLite3动态库是否存在
- **ANSI编码支持**：支持UTF-8和GBK编码的文件读取
- **注释处理**：自动跳过以";"开头的注释行
- **空行处理**：自动跳过空白行

### ✅ 4. 数据库管理
- **自动创建数据库**：在M2Data目录下创建dyzSearch.DB
- **三张表结构**：
  - `Map`：存储地图和怪物刷新信息
  - `MonItems`：存储怪物爆出物品信息
  - `Item`：存储物品信息（去重）
- **数据完整性**：支持概率的分子分母分别存储

### ✅ 5. 数据解析功能
- **MonGen.txt解析**：解析怪物刷新配置
  - 格式：地图名 X坐标 Y坐标 怪物名 范围 数量 刷新时间 [国家] [颜色]
  - 支持制表符和空格分隔
- **怪物物品文件解析**：解析每个怪物的爆出物品
  - 格式：概率 物品名
  - 支持"1/10"格式的概率表示
  - 自动解析分子分母

### ✅ 6. Web界面功能
- **地图查询**：
  - 显示所有地图列表
  - 点击地图查看该地图的怪物刷新信息
  - 支持搜索功能
- **怪物查询**：
  - 显示所有怪物列表
  - 点击怪物查看爆出物品和出现地图
  - 显示爆出概率
  - 支持搜索功能
- **物品查询**：
  - 显示所有物品列表
  - 点击物品查看爆出该物品的怪物
  - 显示爆出概率
  - 支持搜索功能

### ✅ 7. 数据关联查询
- **地图→怪物**：查看地图上的所有怪物刷新信息
- **怪物→物品**：查看怪物的爆出物品及概率
- **怪物→地图**：查看怪物出现的所有地图
- **物品→怪物**：查看爆出该物品的所有怪物及概率
- **跨标签页关联**：支持在不同查询页面间跳转

## 系统特点

### 🎨 用户界面
- **现代化设计**：采用渐变背景和卡片式布局
- **响应式布局**：支持不同屏幕尺寸
- **交互友好**：悬停效果、点击反馈
- **搜索功能**：实时搜索，支持模糊匹配

### 🔧 技术特性
- **编码兼容**：支持UTF-8和GBK编码
- **错误处理**：完善的异常处理机制
- **端口管理**：智能端口检测和配置
- **数据库优化**：高效的SQL查询和索引

### 📊 数据管理
- **自动更新**：程序启动时自动解析和更新数据
- **数据验证**：格式检查和错误提示
- **关联完整**：完整的数据关系映射

## 文件结构

```
查询爆率Python/
├── main.py                    # 主程序文件
├── requirements.txt           # Python依赖
├── README.md                 # 项目说明
├── 使用说明.md               # 详细使用说明
├── 项目总结.md               # 项目总结
├── test_db.py                # 数据库测试脚本
├── sqlite3.dll              # SQLite3动态库
├── MonGen.txt               # 怪物刷新配置
├── Envir/                   # 游戏环境目录
│   └── MonItems/           # 怪物物品目录
│       ├── 红狐狸.txt      # 红狐狸爆出物品
│       ├── 白狐狸.txt      # 白狐狸爆出物品
│       ├── 灰狼.txt        # 灰狼爆出物品
│       ├── 黑狼.txt        # 黑狼爆出物品
│       ├── 棕熊.txt        # 棕熊爆出物品
│       ├── 黑熊.txt        # 黑熊爆出物品
│       ├── 白虎.txt        # 白虎爆出物品
│       └── 金虎.txt        # 金虎爆出物品
├── M2Data/                  # 数据库目录
│   └── dyzSearch.DB        # SQLite数据库
└── templates/               # Web模板目录
    └── index.html          # 主页面模板
```

## 测试数据

系统包含完整的测试数据：

### 地图数据
- FOX02：狐狸地图
- WOLF01：狼地图  
- BEAR01：熊地图
- TIGER01：虎地图

### 怪物数据
- 8种怪物：红狐狸、白狐狸、灰狼、黑狼、棕熊、黑熊、白虎、金虎
- 每个怪物都有对应的爆出物品配置

### 物品数据
- 8种物品：祈祷之刃、龙纹剑、屠龙刀、倚天剑、圣战套装、麻痹戒指、传送戒指、复活戒指
- 不同怪物爆出同一物品的概率不同

## 运行状态

✅ **系统已成功运行**
- 端口：8858
- 数据库：已创建并填充测试数据
- Web界面：可正常访问
- 所有功能：已验证可用

## 扩展性

系统设计具有良好的扩展性：

1. **数据扩展**：可以轻松添加新的怪物、物品、地图
2. **功能扩展**：可以添加数据导出、统计分析等功能
3. **技术扩展**：可以集成其他数据库、添加用户权限等

## 总结

本项目完全实现了您的所有需求：

1. ✅ 获取程序运行目录
2. ✅ 端口检测和配置
3. ✅ 文件检查和数据读取
4. ✅ 数据库创建和管理
5. ✅ 数据解析和存储
6. ✅ Web界面和查询功能
7. ✅ 完整的数据关联查询

系统具有以下优势：
- **功能完整**：实现了所有要求的功能
- **界面美观**：现代化的Web界面
- **操作简单**：直观的用户交互
- **数据准确**：完整的数据关联
- **扩展性强**：易于添加新功能
- **稳定可靠**：完善的错误处理

系统已准备就绪，可以立即投入使用！ 