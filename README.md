# 典狱长数据查询系统

一个现代化的游戏数据查询系统，提供GUI界面和Web查询功能，支持怪物、物品、地图数据的快速查询和分析。

## ✨ 功能特性

### 🎮 数据查询
- **地图查询**: 显示所有地图列表，查看地图怪物刷新信息
- **怪物查询**: 显示所有怪物列表，查看爆出物品和出现地图
- **物品查询**: 显示所有物品列表，查看爆出该物品的怪物
- **概率显示**: 详细显示爆出概率和刷新信息
- **搜索功能**: 支持模糊搜索和精确匹配

### 🖥️ 界面特性
- **现代化GUI**: 基于tkinter的简洁美观界面
- **Web界面**: 响应式Web查询界面，支持移动端
- **实时状态**: 显示服务器状态和运行日志
- **一键启动**: 自动端口检测和进程管理

### 🔧 技术特性
- **自动端口管理**: 智能检测和释放端口占用
- **多编码支持**: 支持GBK、UTF-8等多种编码格式
- **数据库优化**: SQLite数据库，查询速度快
- **进程安全**: 自动清理端口占用进程

## 📋 系统要求

- **Python**: 3.7+
- **操作系统**: Windows 10/11
- **依赖**: Flask 2.3.3+

## 🚀 快速开始

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 准备数据文件
确保服务端目录结构正确：
```
服务端根目录/
├── Config.ini                    # 服务端配置文件
└── Mir200/
    ├── Envir/
    │   ├── MonGen.txt           # 怪物刷新配置
    │   ├── MapInfo.txt          # 地图信息配置
    │   └── MonItems/            # 怪物爆出物品目录
    │       ├── 怪物1.txt        # 怪物1的爆出物品
    │       ├── 怪物2.txt        # 怪物2的爆出物品
    │       └── ...
    └── M2Data/                  # 数据库目录（自动创建）
```

### 3. 运行程序
```bash
python main.py
```

### 4. 使用系统
1. 在GUI界面中选择服务端根目录
2. 点击"初始化数据"开始数据解析
3. 点击"启动服务器"启动Web服务
4. 在浏览器中访问查询界面

## 📁 项目结构

```
项目目录/
├── main.py                      # 主程序入口
├── gui_app.py                   # GUI界面应用
├── web_app.py                   # Web应用
├── data_manager.py              # 数据管理器
├── requirements.txt              # Python依赖
├── README.md                    # 项目说明
├── 项目精简说明.md              # 精简说明
└── 测试服务端目录/              # 测试数据
    └── Mir200/
        ├── Envir/
        │   ├── MonGen.txt
        │   ├── MapInfo.txt
        │   └── MonItems/
        └── M2Data/
```

## 📊 数据格式说明

### MonGen.txt 格式
每行格式：`地图名 X坐标 Y坐标 怪物名 范围 数量 刷新时间(分钟) [国家] [颜色]`
```
示例：FOX02 277 205 红狐狸 400 300 15
```

### 怪物爆出物品文件格式
文件名：`怪物名.txt`
内容格式：`概率 物品名`
```
示例：
1/10 祈祷之刃
1/100 龙纹剑
; 这是注释行
```

## 🗄️ 数据库结构

### Map表（地图信息）
- `id`: 主键
- `map_name`: 地图名
- `x, y`: 坐标
- `monster_name`: 怪物名
- `range_val`: 范围
- `count`: 数量
- `refresh_time`: 刷新时间
- `country`: 国家
- `color`: 颜色

### MonItems表（怪物物品）
- `id`: 主键
- `monster_name`: 怪物名
- `item_name`: 物品名
- `probability`: 概率字符串
- `rate_numerator`: 分子
- `rate_denominator`: 分母

### Item表（物品信息）
- `id`: 主键
- `item_name`: 物品名（唯一）

## 🔧 配置说明

### 端口配置
- 默认端口：8080
- 支持自定义端口号
- 自动检测端口占用并释放

### 编码支持
- 支持GBK、UTF-8等多种编码
- 自动检测文件编码格式
- 兼容不同服务端的编码设置

## 🛠️ 开发说明

### 核心模块
- **GameDataGUI**: GUI界面管理
- **GameDataManager**: 数据解析和管理
- **Flask Web App**: Web查询界面

### 扩展功能
- 支持自定义数据源
- 可扩展查询功能
- 模块化设计，易于维护

## 📝 注意事项

1. **文件编码**: 所有文本文件建议使用ANSI编码（GBK）
2. **端口占用**: 程序会自动检测和释放端口占用
3. **数据库**: 程序会自动创建M2Data目录和数据库文件
4. **进程安全**: 支持自动清理端口占用进程
5. **注释支持**: 支持以";"开头的注释行和空行

## 🤝 贡献

欢迎提交Issue和Pull Request来改进项目！

## 📄 许可证

本项目采用MIT许可证。

---

**典狱长数据查询系统** - 让游戏数据查询更简单、更高效！ 